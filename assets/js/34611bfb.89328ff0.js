"use strict";(self.webpackChunkratis_tmp=self.webpackChunkratis_tmp||[]).push([[4480],{5404:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>i});var t=n(6672);const a={},s=t.createContext(a);function o(e){const r=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(s.Provider,{value:r},e.children)}},6040:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"features/listeners","title":"Non-Voting Members (Listeners)","description":"Why are learners useful?","source":"@site/docs/features/listeners.md","sourceDirName":"features","slug":"/features/listeners","permalink":"/ratis-site/docs/features/listeners","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ratis-site/edit/main/docs/features/listeners.md","tags":[],"version":"current","frontMatter":{"title":"Non-Voting Members (Listeners)"},"sidebar":"tutorialSidebar","previous":{"title":"Leader Lease","permalink":"/ratis-site/docs/features/leader-lease"},"next":{"title":"Unordered Async Read Support","permalink":"/ratis-site/docs/features/unordered-async-read"}}');var a=n(3420),s=n(5404);const o={title:"Non-Voting Members (Listeners)"},i="Support Non-voting Member/Learner in Ratis",l={},d=[{value:"Why are learners useful?",id:"why-are-learners-useful",level:2},{value:"Goals",id:"goals",level:2},{value:"When can a Learner be added into a Raft Ring?",id:"when-can-a-learner-be-added-into-a-raft-ring",level:2},{value:"Leader Election",id:"leader-election",level:2},{value:"When working like a Listener (not promoted as a normal follower)",id:"when-working-like-a-listener-not-promoted-as-a-normal-follower",level:2},{value:"Promote as a normal follower",id:"promote-as-a-normal-follower",level:2},{value:"References",id:"references",level:2}];function h(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"support-non-voting-memberlearner-in-ratis",children:"Support Non-voting Member/Learner in Ratis"})}),"\n",(0,a.jsx)(r.h2,{id:"why-are-learners-useful",children:"Why are learners useful?"}),"\n",(0,a.jsx)(r.p,{children:"The learner is useful to maintain high availability when new servers join a Raft ring (details at thesis 4.2.1). For Apache Ozone SCM HA effort, we have also discussed the possibility to utilize learners as a tool to replace SCM nodes online."}),"\n",(0,a.jsxs)(r.p,{children:["etcd also has an ",(0,a.jsx)(r.a,{href:"https://etcd.io/docs/v3.5/learning/design-learner/",children:"article"})," to explain why learners are useful."]}),"\n",(0,a.jsx)(r.h2,{id:"goals",children:"Goals"}),"\n",(0,a.jsx)(r.p,{children:"Support Learners in Ratis, which can be promoted as a normal follower (thus becoming a voting member). Note that the scope of the Learner in this document is larger than a Listener, because a Learner can replicate state from the Leader, and a Learner can be promoted to a normal Follower."}),"\n",(0,a.jsx)(r.h2,{id:"when-can-a-learner-be-added-into-a-raft-ring",children:"When can a Learner be added into a Raft Ring?"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"When a Raft Ring starts, the initial RaftGroup could include learners."}),"\n",(0,a.jsx)(r.li,{children:"When a Raft Ring is running, learners can join the ring (this requires extending the Admin API)."}),"\n"]}),"\n",(0,a.jsx)(r.h2,{id:"leader-election",children:"Leader Election"}),"\n",(0,a.jsx)(r.p,{children:"In the RaftConfiguration, there will be two sets of peers: one for normal peers which can vote, and the other for learners which cannot vote. So, during leader election, candidates only request votes from normal peers, thus learners will not be counted as part of the majority (because learners won\u2019t receive RequestVote)."}),"\n",(0,a.jsx)(r.p,{children:"Learners still receive AppendEntries so they can update themselves to the newest leader."}),"\n",(0,a.jsx)(r.h2,{id:"when-working-like-a-listener-not-promoted-as-a-normal-follower",children:"When working like a Listener (not promoted as a normal follower)"}),"\n",(0,a.jsxs)(r.p,{children:["A Learner should only accept AppendEntries and InstallSnapshot. A Learner should reject other requests (e.g., write requests) with a ",(0,a.jsx)(r.code,{children:"LearningOnlyException"}),". Note that a Learner is not supposed to join the DataStream chain either."]}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.strong,{children:"Open question:"})," Can the learner serve read requests?\nMy current thought is no, unless there is a specific use case."]}),"\n",(0,a.jsx)(r.h2,{id:"promote-as-a-normal-follower",children:"Promote as a normal follower"}),"\n",(0,a.jsxs)(r.p,{children:["We can extend the Admin API to allow promoting a learner to a follower. What this operation really does is transition the role of the learner to \u201cFOLLOWER\u201d, which will trigger the ",(0,a.jsx)(r.code,{children:"FollowerState"})," daemon to start heartbeating with the leader."]}),"\n",(0,a.jsx)(r.h2,{id:"references",children:"References"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.a,{href:"https://issues.apache.org/jira/browse/RATIS-1298",children:"RATIS-1298"})}),"\n"]})]})}function c(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}}}]);