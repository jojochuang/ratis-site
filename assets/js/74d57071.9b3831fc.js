"use strict";(self.webpackChunkratis_tmp=self.webpackChunkratis_tmp||[]).push([[3082],{2452:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"features/pre-vote","title":"Pre-vote","description":"Purpose","source":"@site/docs/features/pre-vote.md","sourceDirName":"features","slug":"/features/pre-vote","permalink":"/ratis-site/docs/features/pre-vote","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ratis-site/edit/main/docs/features/pre-vote.md","tags":[],"version":"current","frontMatter":{"title":"Pre-vote"},"sidebar":"tutorialSidebar","previous":{"title":"Support Priority in Leader Election","permalink":"/ratis-site/docs/features/leader-election-priority"},"next":{"title":"Observability","permalink":"/ratis-site/docs/features/observability"}}');var n=r(3420),i=r(5404);const o={title:"Pre-vote"},l="Pre-vote",a={},c=[{value:"Purpose",id:"purpose",level:2},{value:"Mechanism",id:"mechanism",level:2},{value:"Configuration",id:"configuration",level:2},{value:"References",id:"references",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"pre-vote",children:"Pre-vote"})}),"\n",(0,n.jsx)(t.h2,{id:"purpose",children:"Purpose"}),"\n",(0,n.jsx)(t.p,{children:"The Pre-vote mechanism in Apache Ratis addresses the issue of unnecessary leader step-downs that can occur when a follower temporarily loses network connectivity and then recovers. Without Pre-vote, such a follower might initiate a new leader election upon recovery, even if a stable leader already exists, leading to disruptions in the cluster."}),"\n",(0,n.jsx)(t.h2,{id:"mechanism",children:"Mechanism"}),"\n",(0,n.jsx)(t.p,{children:"The proposed solution involves a two-phase election process:"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Pre-vote Request:"})," When a follower (e.g., ",(0,n.jsx)(t.code,{children:"s3"}),") believes it needs to request a vote, it first sends a pre-vote request to other servers."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Pre-vote Response:"})," When the current leader (e.g., ",(0,n.jsx)(t.code,{children:"s1"}),") and other followers (e.g., ",(0,n.jsx)(t.code,{children:"s2"}),") receive the pre-vote request, they check their ",(0,n.jsx)(t.code,{children:"electionTimeout"})," to determine if a leader election should be triggered."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.strong,{children:"Preventing Unnecessary Elections:"})," If ",(0,n.jsx)(t.code,{children:"s1"})," and ",(0,n.jsx)(t.code,{children:"s2"})," determine that a new leader election is not necessary (e.g., they are still receiving heartbeats from the current leader), they will refuse the pre-vote request. In this scenario, ",(0,n.jsx)(t.code,{children:"s3"})," remains a follower, preventing an unnecessary election and maintaining cluster stability."]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"configuration",children:"Configuration"}),"\n",(0,n.jsxs)(t.p,{children:["To enable or disable the Pre-vote feature, the following property can be set in ",(0,n.jsx)(t.code,{children:"RaftServerConfigKeys"}),":"]}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Property"}),(0,n.jsx)(t.th,{children:"Description"}),(0,n.jsx)(t.th,{children:"Type"}),(0,n.jsx)(t.th,{children:"Default"})]})}),(0,n.jsx)(t.tbody,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"raft.server.leaderelection.pre-vote"})}),(0,n.jsx)(t.td,{children:"Enable or disable the pre-vote mechanism."}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"boolean"})}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"true"})})]})})]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Methods to set/get this property:"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-java",children:"static boolean preVote(RaftProperties properties);\nstatic void setPreVote(RaftProperties properties, boolean preVote);\n"})}),"\n",(0,n.jsx)(t.h2,{id:"references",children:"References"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://issues.apache.org/jira/browse/RATIS-993",children:"RATIS-993"})}),"\n",(0,n.jsxs)(t.li,{children:["Pull Request: ",(0,n.jsx)(t.a,{href:"https://github.com/apache/ratis/pull/402",children:"https://github.com/apache/ratis/pull/402"})]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},5404:(e,t,r)=>{r.d(t,{R:()=>o,x:()=>l});var s=r(6672);const n={},i=s.createContext(n);function o(e){const t=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);