"use strict";(self.webpackChunkratis_tmp=self.webpackChunkratis_tmp||[]).push([[1263],{286:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"features/linearizable-read","title":"Linearizable Read from Followers","description":"The Raft algorithm allows read-only requests to bypass the Raft log while still maintaining linearizability. This can significantly benefit the read throughput of the entire system. This document outlines the concept of ReadIndex and its implementation in Apache Ratis.","source":"@site/docs/features/linearizable-read.md","sourceDirName":"features","slug":"/features/linearizable-read","permalink":"/ratis-site/docs/features/linearizable-read","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ratis-site/edit/main/docs/features/linearizable-read.md","tags":[],"version":"current","frontMatter":{"title":"Linearizable Read from Followers"},"sidebar":"tutorialSidebar","previous":{"title":"Unordered Async Read Support","permalink":"/ratis-site/docs/features/unordered-async-read"},"next":{"title":"Rolling Upgrade and Rollback","permalink":"/ratis-site/docs/features/rolling-upgrade-rollback"}}');var a=n(4848),t=n(8453);const r={title:"Linearizable Read from Followers"},l="Linearizable Read from Followers",d={},o=[{value:"Raft ReadIndex Algorithm",id:"raft-readindex-algorithm",level:2},{value:"Ratis Implementation Design",id:"ratis-implementation-design",level:2},{value:"API Methods",id:"api-methods",level:2},{value:"Asynchronous API (<code>org.apache.ratis.client.api.AsyncApi</code>)",id:"asynchronous-api-orgapacheratisclientapiasyncapi",level:3},{value:"Blocking API (<code>org.apache.ratis.client.api.BlockingApi</code>)",id:"blocking-api-orgapacheratisclientapiblockingapi",level:3},{value:"Configuration",id:"configuration",level:2},{value:"References",id:"references",level:2}];function c(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.header,{children:(0,a.jsx)(i.h1,{id:"linearizable-read-from-followers",children:"Linearizable Read from Followers"})}),"\n",(0,a.jsx)(i.p,{children:"The Raft algorithm allows read-only requests to bypass the Raft log while still maintaining linearizability. This can significantly benefit the read throughput of the entire system. This document outlines the concept of ReadIndex and its implementation in Apache Ratis."}),"\n",(0,a.jsx)(i.h2,{id:"raft-readindex-algorithm",children:"Raft ReadIndex Algorithm"}),"\n",(0,a.jsx)(i.p,{children:"As described in Raft paper section 6.4, the ReadIndex algorithm ensures linearizable reads:"}),"\n",(0,a.jsxs)(i.ol,{children:["\n",(0,a.jsx)(i.li,{children:"The Leader must at least mark an entry from its current term as committed."}),"\n",(0,a.jsxs)(i.li,{children:["The Leader saves its current commit index as the ",(0,a.jsx)(i.code,{children:"readIndex"}),"."]}),"\n",(0,a.jsx)(i.li,{children:"The Leader issues a new round of heartbeats to all followers and waits for their acknowledgments."}),"\n",(0,a.jsxs)(i.li,{children:["The Leader waits for its state machine to advance at least as far as the ",(0,a.jsx)(i.code,{children:"readIndex"}),"."]}),"\n",(0,a.jsx)(i.li,{children:"The Leader issues the query against its state machine and replies to the client."}),"\n"]}),"\n",(0,a.jsx)(i.h2,{id:"ratis-implementation-design",children:"Ratis Implementation Design"}),"\n",(0,a.jsx)(i.p,{children:"Apache Ratis implements the leader ReadIndex method, similar to Sofa-Jraft, as a basis for future follower ReadIndex support. The key aspects of the Ratis design include:"}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"Client Request Type:"})," A new ",(0,a.jsx)(i.code,{children:"ClientRequestType"}),", ",(0,a.jsx)(i.code,{children:"ReadIndex"}),", is introduced."]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"Leader Handling:"})," The ",(0,a.jsx)(i.code,{children:"RaftServerImpl#submitClientRequestAsync()"})," method includes a new branch to handle ",(0,a.jsx)(i.code,{children:"ReadIndex"})," requests."]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"Heartbeat Validation:"})," For each ",(0,a.jsx)(i.code,{children:"readIndex"})," request, a new round of heartbeats is sent. If the heartbeat check passes (i.e., a majority of followers acknowledge), the request is added to a pending queue."]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"State Machine Advancement:"})," The pending ",(0,a.jsx)(i.code,{children:"readIndex"})," requests are checked and removed in ",(0,a.jsx)(i.code,{children:"ApplyLog()"})," once the state machine's applied index has advanced sufficiently."]}),"\n"]}),"\n",(0,a.jsx)(i.h2,{id:"api-methods",children:"API Methods"}),"\n",(0,a.jsx)(i.p,{children:"To utilize linearizable reads, the following methods are available in the client APIs:"}),"\n",(0,a.jsxs)(i.h3,{id:"asynchronous-api-orgapacheratisclientapiasyncapi",children:["Asynchronous API (",(0,a.jsx)(i.code,{children:"org.apache.ratis.client.api.AsyncApi"}),")"]}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{className:"language-java",children:"CompletableFuture sendReadOnly(Message message);\n"})}),"\n",(0,a.jsxs)(i.p,{children:["Sends the given readonly message asynchronously to the Raft service. When ",(0,a.jsx)(i.code,{children:"raft.server.read.option"})," is set to ",(0,a.jsx)(i.code,{children:"LINEARIZABLE"}),", this method performs a linearizable read."]}),"\n",(0,a.jsxs)(i.h3,{id:"blocking-api-orgapacheratisclientapiblockingapi",children:["Blocking API (",(0,a.jsx)(i.code,{children:"org.apache.ratis.client.api.BlockingApi"}),")"]}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{className:"language-java",children:"RaftClientReply sendReadOnly(Message message) throws IOException;\n"})}),"\n",(0,a.jsxs)(i.p,{children:["Sends the given readonly message to the Raft service. When ",(0,a.jsx)(i.code,{children:"raft.server.read.option"})," is set to ",(0,a.jsx)(i.code,{children:"LINEARIZABLE"}),", this method performs a linearizable read."]}),"\n",(0,a.jsx)(i.h2,{id:"configuration",children:"Configuration"}),"\n",(0,a.jsxs)(i.p,{children:["To enable linearizable reads, the following properties can be configured in ",(0,a.jsx)(i.code,{children:"RaftServerConfigKeys"}),":"]}),"\n",(0,a.jsxs)(i.table,{children:[(0,a.jsx)(i.thead,{children:(0,a.jsxs)(i.tr,{children:[(0,a.jsx)(i.th,{children:"Property"}),(0,a.jsx)(i.th,{children:"Description"}),(0,a.jsx)(i.th,{children:"Type"}),(0,a.jsx)(i.th,{children:"Default"})]})}),(0,a.jsxs)(i.tbody,{children:[(0,a.jsxs)(i.tr,{children:[(0,a.jsx)(i.td,{children:(0,a.jsx)(i.code,{children:"raft.server.read.option"})}),(0,a.jsx)(i.td,{children:"Option for processing read-only requests."}),(0,a.jsxs)(i.td,{children:[(0,a.jsx)(i.code,{children:"Read.Option"})," enum (",(0,a.jsx)(i.code,{children:"DEFAULT"}),", ",(0,a.jsx)(i.code,{children:"LINEARIZABLE"}),")"]}),(0,a.jsx)(i.td,{children:(0,a.jsx)(i.code,{children:"Read.Option.DEFAULT"})})]}),(0,a.jsxs)(i.tr,{children:[(0,a.jsx)(i.td,{children:(0,a.jsx)(i.code,{children:"raft.server.read.timeout"})}),(0,a.jsx)(i.td,{children:"Request timeout for linearizable read-only requests."}),(0,a.jsx)(i.td,{children:(0,a.jsx)(i.code,{children:"TimeDuration"})}),(0,a.jsx)(i.td,{children:(0,a.jsx)(i.code,{children:"10s"})})]})]})]}),"\n",(0,a.jsxs)(i.p,{children:["When ",(0,a.jsx)(i.code,{children:"raft.server.read.option"})," is set to ",(0,a.jsx)(i.code,{children:"LINEARIZABLE"}),", the ",(0,a.jsx)(i.code,{children:"sendReadOnly"})," methods in the client APIs will perform linearizable reads using the ReadIndex mechanism."]}),"\n",(0,a.jsx)(i.h2,{id:"references",children:"References"}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://issues.apache.org/jira/browse/RATIS-1557",children:"RATIS-1557"})}),"\n",(0,a.jsxs)(i.li,{children:["Pull Request: ",(0,a.jsx)(i.a,{href:"https://github.com/apache/ratis/pull/700",children:"https://github.com/apache/ratis/pull/700"})]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,t.R)(),...e.components};return i?(0,a.jsx)(i,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>r,x:()=>l});var s=n(6540);const a={},t=s.createContext(a);function r(e){const i=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(t.Provider,{value:i},e.children)}}}]);